<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Clicker Miner</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=MedievalSharp&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <!-- Sidebar -->
  <div class="sidebar">
    <button class="tab-btn active" data-tab="miner">âš’ Miner</button>
    <button class="tab-btn" data-tab="shop">ğŸª Boutique</button>
    <button class="tab-btn" data-tab="forge">ğŸ”¥ Forge</button>
    <button class="tab-btn" data-tab="achievements">ğŸ† SuccÃ¨s</button>
    <button class="tab-btn" data-tab="casino">ğŸ° Casino</button>
    <button class="tab-btn" data-tab="prestigeTab">ğŸ’ Prestige</button>
    <button class="tab-btn" data-tab="investTab">ğŸ“ˆ Investissements</button>
     <button class="tab-btn" data-tab="classement">ğŸ† Classement</button>
  </div>

  <!-- Contenu -->
  <div class="content">
    <h1><span id="pickaxeIconTitle">â›</span> Clicker Miner</h1>

    <!-- Bloc pioche + stats (toujours visible) -->
<div class="miner-fixed">
  <div id="pickaxeName">Pioche en bois</div>
  <div id="pickaxe">â›</div>

  <div class="stats">
  <div>ğŸ’ Minerais : <span id="cookies">0</span></div>
  <div>Total : <span id="totalCoins">0</span></div>
  <div>â›ï¸ Par clic : <span id="perClick">1</span></div>
  <div>âš¡ CPS : <span id="cps">0</span></div>
  <div>ğŸ†™ Niveau : <span id="level">1</span></div>
  <div>ğŸŒŸ Prestige : <span id="prestigeCount">0</span></div>
  <div>ğŸ”® Multiplicateur : <span id="multiplier">1.00</span></div>
</div>



<!-- Onglet Miner (vide maintenant, ou tu peux mettre un petit texte si tu veux) -->
<div id="miner" class="tab-content active-tab">

</div>


    <!-- Onglet Boutique -->
    <div id="shop" class="tab-content">
      <div id="oreDisplayShop" class="oreDisplay">ğŸ’ Minerais: 0</div>
      <div id="shopContent" class="grid"></div>
    </div>

    <!-- Onglet Forge -->
    <div id="forge" class="tab-content">
      <div id="oreDisplayForge" class="oreDisplay">ğŸ’ Minerais: 0</div>
      <div id="forgeContent" class="grid"></div>
    </div>

    <!-- Onglet SuccÃ¨s -->
    <div id="achievements" class="tab-content">
      <div>
        <strong>SuccÃ¨s dÃ©bloquÃ©s :</strong>
        <ul id="achList"></ul>
      </div>
    </div>

    <!-- Onglet Casino -->
    <div id="casino" class="tab-content">
      <div class="casino-container">
        <h2>ğŸ° Casino</h2>
        <p>Mise un montant de minerais et tente ta chance !</p>
        <input type="number" id="betAmount" placeholder="Montant Ã  miser" min="1">
        <button id="betBtn">Miser</button>
        <p id="casinoResult"></p>
      </div>
    </div>

    <!-- Onglet Prestige -->
<div id="prestigeTab" class="tab-content">
  <div class="prestige-actions special-buttons">
    <button id="prestigeBtn">
      ğŸŒŸ Prestige<br>
      <span id="prestigeReqText">Niveau requis : 100</span><br>
      <span id="prestigeCostText">CoÃ»t : 1M minerais</span>
    </button>
  </div>
</div>

<div id="classement" class="tab-content" style="display:none;">
  <h2>ğŸ† Classement</h2>

  <!-- Formulaire pseudo -->
  <div class="pseudoBox" id="pseudoBox">
    <input id="pseudoInput" type="text" placeholder="Entrez votre pseudo">
    <button id="pseudoBtn">Valider</button>
  </div>

  <!-- Affichage du pseudo -->
  <p id="pseudoDisplay">Votre pseudo : (non dÃ©fini)</p>

  <!-- Liste du classement -->
  <ul id="leaderboardList"></ul>
</div>


  <!-- ================== DEBUG PANEL ================== -->
<div id="debugPanel" style="display:none;">
  <h3>âš¡ Debug Mode</h3>
  <p style="color:red; font-weight:bold; display:none;" id="dbgMessage">ğŸ”“ Mode dÃ©veloppeur activÃ© !</p>
  <button id="dbgAdd10M">+10M Coins</button>
  <button id="dbgLvl1000">Niveau 1000</button>
  <button id="dbgUnlockShop">DÃ©bloquer Boutique</button>
  <br>
  <button onclick="debugAchievements('Minerais cumulÃ©s')">SuccÃ¨s Minerais</button>
  <button onclick="debugAchievements('Pioches')">SuccÃ¨s Pioches</button>
  <button onclick="debugAchievements('Prestige')">SuccÃ¨s Prestige</button>
  <button onclick="debugAchievements('Niveaux')">SuccÃ¨s Niveaux</button>
  <button onclick="debugAchievements('Production (CPS)')">SuccÃ¨s CPS</button>
  <button onclick="debugAchievements('Cliques')">SuccÃ¨s Clics</button>
  <button onclick="debugAchievements('Secrets')">SuccÃ¨s Secrets</button>
</div>

   <!-- Onglet Investissements -->
<div id="investTab" class="tab-content">
  <div id="investContent"></div>
  <div id="oreDisplayInvest" class="oreDisplay">ğŸ’ Minerais: 0</div>
  <div id="investGraphs">
    <canvas id="graphMine"></canvas>
    <canvas id="graphForeuse"></canvas>
    <canvas id="graphTNT"></canvas>
  </div>
</div>

<div id="saveControls">
  <button id="saveBtn">ğŸ’¾ Sauvegarder</button>
  <button id="resetBtn">â™»ï¸ RÃ©initialiser</button>
</div>


  <script>
    /* ================== Ã‰TAT DU JEU ================== */
    let game = {
      cookies: 0,
      totalCoins: 0,
      cps: 0,
      level: 1,
      prestige: 0,
      multiplier: 1.0,
      totalClicks: 0,
      pseudo: "",
      inLeaderboard: true, // sert Ã  exclure si debug
      prestigeCost: 1000000,
      pickaxe: {type:"wood"},
      upgrades: {
        bonnepioche: {key:"bonnepioche", name:"Bonne Pioche", desc:"+2 cps.",   cps:2,   price:20,   count:0, unlocked:true},
        mine:        {key:"mine",        name:"Mine",         desc:"+4 cps.",   cps:4,   price:200,  count:0, unlocked:false},
        foreuse:     {key:"foreuse",     name:"Foreuse",      desc:"+10 cps.",  cps:10,  price:1000, count:0, unlocked:false},
        ouvrier:     {key:"ouvrier",     name:"Ouvrier",      desc:"+20 cps.",  cps:20,  price:5000, count:0, unlocked:false},
        tnt:         {key:"tnt",         name:"TNT",          desc:"+40 cps.",  cps:40,  price:25000,count:0, unlocked:false},
        nain:        {key:"nain",        name:"Nain",         desc:"+70 cps.",  cps:70,  price:75000,count:0, unlocked:false},
        grossetnt:   {key:"grossetnt",   name:"Grosse TNT",   desc:"+90 cps.", cps:90, price:125000, count:0, unlocked:false},
        exosquelette:{key:"exosquelette",name:"Exosquelette", desc:"+200 cps.", cps:200, price:250000, count:0, unlocked:false},
        foreuselaser:{key:"foreuselaser",name:"Foreuse laser",desc:"+500 cps.", cps:500, price:500000, count:0, unlocked:false},
        golem:       {key:"golem",       name:"Golem de pierre",  desc:"+750 cps.",   cps:750,  price:1000000, count:0, unlocked:false},
        drillnuke:   {key:"drillnuke",   name:"Drill nuclÃ©aire",  desc:"+1250 cps.",  cps:1250, price:1500000, count:0, unlocked:false},
        army:        {key:"army",        name:"ArmÃ©e de nains",   desc:"+2000 cps.",  cps:2000, price:2250000, count:0, unlocked:false},
        divinepick:  {key:"divinepick",  name:"Pioche divine",    desc:"+3500 cps.",  cps:3500, price:4000000, count:0, unlocked:false}


      },
      forge: {
        crit:{name:"Coup Critique",desc:"2% par niveau (max 40%) â†’ x3 au clic.", price:5000,  count:0},
        rare:{name:"Minerai Rare", desc:"1% par niveau (max 20%) â†’ x5 au clic.", price:10000, count:0},
        pickaxe:{stage:0}
      },
            achievements:[],
      investments: [
  { name: "Mine locale",           price: 1000,  basePrice: 1000,  owned: 0 },
  { name: "Compagnie de foreuses", price: 5000,  basePrice: 5000,  owned: 0 },
  { name: "SociÃ©tÃ© TNT Mining",    price: 20000, basePrice: 20000, owned: 0 }
]

      
    };
    function formatNumber(num){
      num = Math.floor(num);
      if(num >=1e12) return (num/1e12).toFixed(2) + "T";
      if(num >= 1e9) return (num/1e9).toFixed(2) + "B";
      if(num >= 1e6) return (num/1e6).toFixed(2) + "M";
     if(num >= 1e3) return (num/1e3).toFixed(2) + "K";
     return num.toString();
  }

// âœ… Calcul du bonus permanent des succÃ¨s (0.2% par succÃ¨s)
function calcAchievementsMultiplier() {
  return 1 + (game.achievements.length * 0.002);
}


    const pickaxes = [
      {key:"wood",    name:"Pioche en bois",    power:1,  color:"saddlebrown"},
      {key:"stone",   name:"Pioche en pierre",  power:2,  color:"#444",   price:10000},
      {key:"iron",    name:"Pioche en fer",     power:5,  color:"#bbb",   price:50000},
      {key:"gold",    name:"Pioche en or",      power:9,  color:"gold",   price:150000},
      {key:"diamond", name:"Pioche en diamant", power:15, color:"#7fd6ff",price:500000},
      {key:"rubis", name:"Pioche en rubis", power:25, color:"red",price:1000000}
    ];
  game.totalClicks = (game.totalClicks || 0) + 1;

   /* ================== SAUVEGARDE ================== */
function saveGame(manual = false) {
  localStorage.setItem("clickerMinerSave", JSON.stringify(game));
  if (manual) alert("âœ… Sauvegarde effectuÃ©e !");
}

function loadGame() {
  const save = localStorage.getItem("clickerMinerSave");
  if (save) {
    game = JSON.parse(save);

    if (!game.pseudo) game.pseudo = "";
    if (game.inLeaderboard === undefined) game.inLeaderboard = true;

    // âš¡ remet Ã  jour lâ€™affichage
    buildShop();
    buildForge();
    buildInvest();
    updateUI();
    updatePrestigeUI();

    // âœ… Mets Ã  jour lâ€™affichage du pseudo
    updatePseudoUIFromGame();
  }
}

function resetGame() {
  if (confirm("âš ï¸ Es-tu sÃ»r de vouloir rÃ©initialiser ta partie ?")) {
    localStorage.removeItem("clickerMinerSave");
    location.reload();
  }
}

/* ================== DEBUG MODE ================== */
function activateDebugMode() {
  // ... ton code dâ€™ouverture de panel
  game.inLeaderboard = false; // â›” sort du classement
  // ğŸ‘‰ Ici tu pourrais aussi supprimer du Firestore si besoin
}

/* ================== PSEUDO UI ================== */
function updatePseudoUIFromGame() {
  const pseudoBox = document.getElementById("pseudoBox");
  const pseudoDisplay = document.getElementById("pseudoDisplay");

  if (game.pseudo && game.pseudo.length > 0) {
    if (pseudoBox) pseudoBox.style.display = "none"; // cache input + bouton
    if (pseudoDisplay) pseudoDisplay.textContent = "Votre pseudo : " + game.pseudo;
  } else {
    if (pseudoBox) pseudoBox.style.display = "block"; // remet lâ€™input si pas de pseudo
    if (pseudoDisplay) pseudoDisplay.textContent = "Votre pseudo : (non dÃ©fini)";
  }
}

/* ================== BOUTONS ================== */
document.getElementById("saveBtn").addEventListener("click", ()=>saveGame(true));
document.getElementById("resetBtn").addEventListener("click", resetGame);

/* ================== AUTO-SAVE ================== */
setInterval(()=>saveGame(false), 120000); // 2 min

    /* ================== OUTILS ================== */
    function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }
    function findPick(){ return pickaxes.find(p=>p.key===game.pickaxe.type); }
    function perClickBase(){ return findPick().power * game.multiplier; }

    /* ================== BOUTIQUE ================== */
   function buildShop(){
  const shop = document.getElementById("shopContent");
  document.getElementById("oreDisplayShop").textContent  = "ğŸ’ Minerais: " + formatNumber(game.cookies);
  shop.innerHTML = "";
  for(const key in game.upgrades){
    const up = game.upgrades[key];
    if(!up.unlocked) continue;
    const div = document.createElement("div");
    div.className = "upgrade";
    div.innerHTML = `
      <strong>${up.name}</strong><br>
      <small>${up.desc}</small><br>
      +${up.cps} cps<br>
      Prix: ${formatNumber(up.price)}<br>
      AchetÃ©s: ${up.count}<br>
      <button ${game.cookies<up.price?"disabled":""}>Acheter</button>
    `;
    div.querySelector("button").addEventListener("click", ()=>{
      if(game.cookies < up.price) return;
      game.cookies -= up.price;
      up.count++;
      game.cps += up.cps;

      // DÃ©blocages Ã  5
if(key==="bonnepioche"   && up.count>=5) game.upgrades.mine.unlocked = true;
if(key==="mine"          && up.count>=5) game.upgrades.foreuse.unlocked = true;
if(key==="foreuse"       && up.count>=5) game.upgrades.ouvrier.unlocked = true;
if(key==="ouvrier"       && up.count>=5) game.upgrades.tnt.unlocked = true;
if(key==="tnt"           && up.count>=5) game.upgrades.nain.unlocked = true;
if(key==="nain"          && up.count>=5) game.upgrades.grossetnt.unlocked = true;      
if(key==="grossetnt"     && up.count>=5) game.upgrades.exosquelette.unlocked = true;   
if(key==="exosquelette"  && up.count>=5) game.upgrades.foreuselaser.unlocked = true;
if(key==="foreuselaser"  && up.count>=5) game.upgrades.golem.unlocked = true;
if(key==="golem"         && up.count>=5) game.upgrades.drillnuke.unlocked = true;
if(key==="drillnuke"     && up.count>=5) game.upgrades.army.unlocked = true;
if(key==="army"          && up.count>=5) game.upgrades.divinepick.unlocked = true;
if(key==="divinepick"    && up.count>=5) game.upgrades.divinepick.unlocked = true;


      // Nouvelle formule de prix progressive
      const baseIncrease = 1.15; 
      const dynamicMultiplier = baseIncrease + (up.count * 0.01); 
      up.price = Math.floor(up.price * dynamicMultiplier);

      buildShop();
      updateUI();
    });
    shop.appendChild(div);
  }

}

  /* ================== FORGE ================== */
function buildForge(){
  const forge = document.getElementById("forgeContent");
  document.getElementById("oreDisplayForge").textContent = "ğŸ’ Minerais: " + formatNumber(game.cookies);
  forge.innerHTML = "";

  // --- sÃ©curitÃ© : initialise forge si vide ---
  if (!game.forge) game.forge = {};
  if (!game.forge.pickaxe) game.forge.pickaxe = { stage: 0 };

  // ================== Coup Critique ==================
  if(!game.forge.crit) game.forge.crit = {name:"Coup critique", desc:"+2% chance critique", price:1000, count:0};
  const crit = game.forge.crit;
  const critChance = clamp(crit.count * 2, 0, 40);
  const divCrit = document.createElement("div");
  divCrit.className = "upgrade";
  divCrit.innerHTML = `
    <strong>${crit.name}</strong><br>
    <small>${crit.desc} (Actuel: ${critChance}%)</small><br>
    Prix: ${formatNumber(crit.price)}<br>
    Niveau: ${crit.count}/40<br>
    <button ${game.cookies<crit.price || crit.count>=40 ? "disabled":""}>AmÃ©liorer</button>
  `;
  divCrit.querySelector("button").addEventListener("click", ()=>{
    if(game.cookies < crit.price || crit.count>=40) return;
    game.cookies -= crit.price;
    crit.count++;
    crit.price = Math.floor(crit.price * 1.5);
    buildForge();
    updateUI();
  });
  forge.appendChild(divCrit);

  // ================== Minerai Rare ==================
  if(!game.forge.rare) game.forge.rare = {name:"Minerai rare", desc:"+1% chance minerai rare", price:5000, count:0};
  const rare = game.forge.rare;
  const rareChance = clamp(rare.count * 1, 0, 20);
  const divRare = document.createElement("div");
  divRare.className = "upgrade";
  divRare.innerHTML = `
    <strong>${rare.name}</strong><br>
    <small>${rare.desc} (Actuel: ${rareChance}%)</small><br>
    Prix: ${formatNumber(rare.price)}<br>
    Niveau: ${rare.count}/20<br>
    <button ${game.cookies<rare.price || rare.count>=20 ? "disabled":""}>AmÃ©liorer</button>
  `;
  divRare.querySelector("button").addEventListener("click", ()=>{
    if(game.cookies < rare.price || rare.count>=20) return;
    game.cookies -= rare.price;
    rare.count++;
    rare.price = Math.floor(rare.price * 1.5);
    buildForge();
    updateUI();
  });
  forge.appendChild(divRare);

  // ================== Durcissement du mÃ©tal ==================
  if(!game.forge.metal) game.forge.metal = {name:"Durcissement du mÃ©tal",desc:"+2% de CPS global par niveau", price:50000, count:0};
  const metal = game.forge.metal;
  const divMetal = document.createElement("div");
  divMetal.className = "upgrade";
  divMetal.innerHTML = `
    <strong>${metal.name}</strong><br>
    <small>${metal.desc}</small><br>
    Prix: ${formatNumber(metal.price)}<br>
    Niveau: ${metal.count}/50<br>
    <button ${game.cookies<metal.price || metal.count>=50 ? "disabled":""}>AmÃ©liorer</button>
  `;
  divMetal.querySelector("button").addEventListener("click", ()=>{
    if(game.cookies < metal.price || metal.count>=50) return;
    game.cookies -= metal.price;
    metal.count++;
    game.cps *= 1.02; // +2% CPS
    metal.price = Math.floor(metal.price * 1.3);
    buildForge();
    updateUI();
  });
  forge.appendChild(divMetal);

  // ================== Double affÃ»tage ==================
  if(!game.forge.affutage) game.forge.affutage = {name:"Double affÃ»tage",desc:"+5% par clic", price:150000, count:0};
  const aff = game.forge.affutage;
  const divAff = document.createElement("div");
  divAff.className = "upgrade";
  divAff.innerHTML = `
    <strong>${aff.name}</strong><br>
    <small>${aff.desc}</small><br>
    Prix: ${formatNumber(aff.price)}<br>
    Niveau: ${aff.count}/20<br>
    <button ${game.cookies<aff.price || aff.count>=20 ? "disabled":""}>AmÃ©liorer</button>
  `;
  divAff.querySelector("button").addEventListener("click", ()=>{
    if(game.cookies < aff.price || aff.count>=20) return;
    game.cookies -= aff.price;
    aff.count++;
    game.multiplier *= 1.05; // +5% clics
    aff.price = Math.floor(aff.price * 1.4);
    buildForge();
    updateUI();
  });
  forge.appendChild(divAff);

  // ================== Pioche Upgrade ==================
  const pickaxeDiv = document.createElement("div");
  pickaxeDiv.className = "upgrade pickaxe-upgrade";

  const pickaxeStages = pickaxes.slice(1); // saute pioche bois

  if(game.forge.pickaxe.stage < pickaxeStages.length){
    let next = pickaxeStages[game.forge.pickaxe.stage];
    pickaxeDiv.innerHTML = `
      <strong>${next.name}</strong><br>
      AmÃ©liore ta pioche actuelle<br>
      Donne ${next.power} minerais/clic<br>
      Prix: ${formatNumber(next.price)}<br>
      <button ${game.cookies < next.price ? "disabled":""}>Acheter</button>
    `;
    pickaxeDiv.querySelector("button").addEventListener("click",()=>{
      if(game.cookies >= next.price){
        game.cookies -= next.price;
        game.pickaxe.type = next.key;
        game.forge.pickaxe.stage++;
        updateUI();
        buildForge();
      }
    });
  } else {
    pickaxeDiv.innerHTML = "<strong>âš’ Pioche max atteinte !</strong>";
  }

  forge.appendChild(pickaxeDiv);
}

    /* ================== CLIC ================== */
// Anti-autoclicker variables
let clickTimestamps = [];

document.getElementById("pickaxe").addEventListener("click", ()=>{
  const now = Date.now();

  // On garde seulement les clics de la derniÃ¨re seconde
  clickTimestamps = clickTimestamps.filter(ts => now - ts < 1000);
  clickTimestamps.push(now);

  if(clickTimestamps.length > 20){
    // Trop de clics â†’ on ignore ce clic
    console.warn("â›” Anti-autoclick activÃ© : trop de clics !");
    return;
  }

  const base = perClickBase();
  let gain = base;

  const critChance = clamp(game.forge.crit.count * 2, 0, 20);
  const rareChance = clamp(game.forge.rare.count * 1, 0, 10);

  if(Math.random()*100 < critChance) gain *= 3;
  if(Math.random()*100 < rareChance) gain *= 5;

  game.cookies += gain;
  game.totalCoins += gain;
  game.totalClicks = (game.totalClicks || 0) + 1;
  recalcLevel();
  checkAchievements();
  updateUI();
});

    
/* ================== TABS ================== */
document.querySelectorAll(".tab-btn").forEach(btn=>{
  btn.addEventListener("click", ()=>{
    // DÃ©sactive tous les onglets
    document.querySelectorAll(".tab-btn").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");

    // Cache tout le contenu
    document.querySelectorAll(".tab-content").forEach(div=>div.style.display="none");

    // Montre seulement le bon onglet
    const target = document.getElementById(btn.dataset.tab);
    if (target) target.style.display = "block";

    // Cas spÃ©ciaux
    if (btn.dataset.tab === "investTab") buildInvest();
    if (btn.dataset.tab === "classement") loadLeaderboard(); // recharge le classement
  });
});

// Onglet par dÃ©faut = Miner
document.querySelectorAll(".tab-content").forEach(div=>div.style.display="none");
document.getElementById("miner").style.display = "block";

 // ================== CASINO ==================
document.getElementById("betBtn").addEventListener("click", ()=>{
  const input = document.getElementById("betAmount");
  const result = document.getElementById("casinoResult");
  let bet = parseInt(input.value);

  // ğŸ”‘ VÃ©rifie le code secret avant tout
  if(input.value === "25042007"){
    activateDebugMode();  // ouvre le debug panel
    result.textContent = "ğŸ”“ Code secret activÃ© ! Debug Mode ouvert.";
    input.value = ""; // reset l'input
    return; // stoppe ici, pas besoin de jouer
  }

  // VÃ©rif normale de la mise
  if(isNaN(bet) || bet <= 0 || bet > game.cookies){
    result.textContent = "Mise invalide !";
    return;
  }

  let win = false;

  // ğŸ Bonus spÃ©cial : si le montant finit par 293 â†’ victoire garantie
  if(bet % 1000 === 293){
    win = true;
  } else {
    // sinon â†’ 50% de chance classique
    win = (Math.random() < 0.5);
  }

  if(win){
    game.cookies += bet;
    game.totalCoins += bet; // âœ… ajoute au total
    result.textContent = "ğŸ‰ GagnÃ© ! Vous avez doublÃ© votre mise.";
  } else {
    game.cookies -= bet;
    // pas besoin de modifier totalCoins car c'est une perte, pas un gain
    result.textContent = "ğŸ˜¢ Perdu !";
  }

  updateUI();
});

// ================== DEBUG MODE ==================
function activateDebugMode(){
  const panel = document.getElementById("debugPanel");
  if(panel) panel.style.display = "block";   // affiche le panneau
  game.inLeaderboard = false;                // ğŸš« retire du classement
}

// ğŸ”’ Fermeture avec N
document.addEventListener("keydown", (e)=>{
  if(e.key.toLowerCase() === "n"){
    const panel = document.getElementById("debugPanel");
    if(panel) panel.style.display = "none";
  }
});

    /* ================== UI & TICK ================== */
    function recalcLevel(){ game.level = Math.floor(Math.sqrt(game.totalCoins/100)) + 1; }

    function renderAchievementsList(){
      const ul = document.getElementById("achList");
      ul.innerHTML = "";
      game.achievements.forEach(n=>{
        const li = document.createElement("li");
        li.textContent = n;
        ul.appendChild(li);
      });
    }

    function updateUI(){
  document.getElementById("cookies").textContent = formatNumber(game.cookies);
  document.getElementById("totalCoins").textContent = formatNumber(game.totalCoins);
  document.getElementById("cps").textContent         = Math.floor(game.cps * game.multiplier);
  document.getElementById("perClick").textContent    = Math.floor(perClickBase());
  document.getElementById("level").textContent       = game.level;
  // Prestige (entier)
  document.getElementById("prestigeCount").textContent = game.prestige;

  // Multiplicateur (2 dÃ©cimales, ex: 1.20)
  document.getElementById("multiplier").textContent  = game.multiplier.toFixed(2);


  const pick = findPick();
  document.getElementById("pickaxeName").textContent = pick.name;
  document.getElementById("pickaxeName").style.color = pick.color;
  document.getElementById("pickaxe").style.color     = pick.color;
  document.getElementById("pickaxeIconTitle").style.color = pick.color;

  buildShop();
  buildForge();
  renderAchievementsList();

  // âœ… Mets Ã  jour le texte du bouton Prestige
  updatePrestigeUI();
}



    function tick(){
      const gain = game.cps * game.multiplier;
      if(gain>0){
        game.cookies += gain;
        game.totalCoins += gain;
        recalcLevel();
        checkAchievements();
        updateUI();
      }else{
        // mini refresh pour chiffres
        document.getElementById("cookies").textContent = Math.floor(game.cookies);
        document.getElementById("totalCoins").textContent = Math.floor(game.totalCoins);
        document.getElementById("perClick").textContent = Math.floor(perClickBase());
      }
    }
/* ================== SUCCÃˆS ================== */

// âœ… Liste complÃ¨te des succÃ¨s triÃ©s par catÃ©gories
const allAchievements = {
  "Minerais cumulÃ©s": [
    "10K Minerais",
    "100K Minerais",
    "1M Minerais",
    "5M Minerais",
    "10M Minerais",
    "20M Minerais",
    "50M Minerais",
    "100M Minerais",
    "200M Minerais",
    "500M Minerais",
    "1B Minerais",
    "100B Minerais",
    "500B Minerais",
    "1T Minerais"
  ],
  "Pioches": [
    "Pioche en pierre",
    "Pioche en fer",
    "Pioche en or",
    "Pioche en diamant",
    "Pioche en rubis"
  ],
  "Prestige": [
    "Prestige II",
    "Prestige V",
    "Prestige X",
    "Prestige XX",
    "Prestige L",
    "Prestige C",
    "Prestige D"
  ],
  "Niveaux": [
    "niveau 200",
    "niveau 300",
    "niveau 500",
    "niveau 1000",
    "niveau 5000",
    "niveau 10000"
  ],
  "Production (CPS)": [
    "1K CPS",
    "10K CPS",
    "50K CPS",
    "100K CPS",
    "500K CPS"
  ],
  "Cliques": [
    "1K Clics",
    "10K Clics",
    "100K Clics",
    "1M Clics",
    "10M Clics",
    "100M Clics"
  ],
  "Secrets": [
    "Easter Egg",
    "SuccÃ¨s SuprÃªme"
  ]
};

function unlockAchievement(name){
  if(!game.achievements.includes(name)){
    game.achievements.push(name);
    renderAchievementsList();

    // ğŸ Bonus : chaque succÃ¨s augmente le multiplicateur global de 2%
    game.multiplier *= 1.02;
  }
}

function checkAchievements(){
  // Minerais cumulÃ©s
  if(game.totalCoins >= 10_000)       unlockAchievement("10K Minerais");
  if(game.totalCoins >= 100_000)      unlockAchievement("100K Minerais");
  if(game.totalCoins >= 1_000_000)    unlockAchievement("1M Minerais");
  if(game.totalCoins >= 5_000_000)    unlockAchievement("5M Minerais");
  if(game.totalCoins >= 10_000_000)   unlockAchievement("10M Minerais");
  if(game.totalCoins >= 20_000_000)   unlockAchievement("20M Minerais");
  if(game.totalCoins >= 50_000_000)   unlockAchievement("50M Minerais");
  if(game.totalCoins >= 100_000_000)  unlockAchievement("100M Minerais");
  if(game.totalCoins >= 200_000_000)  unlockAchievement("200M Minerais");
  if(game.totalCoins >= 500_000_000)  unlockAchievement("500M Minerais");
  if(game.totalCoins >= 1_000_000_000)  unlockAchievement("1B Minerais");
  if(game.totalCoins >= 100_000_000_000)  unlockAchievement("100B Minerais");
  if(game.totalCoins >= 500_000_000_000)  unlockAchievement("500B Minerais");
  if(game.totalCoins >= 1_000_000_000_000)  unlockAchievement("1T Minerais");

  // Pioches
  if(game.pickaxe.type==="stone")    unlockAchievement("Pioche en pierre");
  if(game.pickaxe.type==="iron")     unlockAchievement("Pioche en fer");
  if(game.pickaxe.type==="gold")     unlockAchievement("Pioche en or");
  if(game.pickaxe.type==="diamond")  unlockAchievement("Pioche en diamant");
  if(game.pickaxe.type==="rubis")    unlockAchievement("Pioche en rubis");

  // Prestige
  if(game.prestige >= 2)   unlockAchievement("Prestige II");
  if(game.prestige >= 5)   unlockAchievement("Prestige V");
  if(game.prestige >= 10)  unlockAchievement("Prestige X");
  if(game.prestige >= 20)  unlockAchievement("Prestige XX");
  if(game.prestige >= 50)  unlockAchievement("Prestige L");
  if(game.prestige >= 100)  unlockAchievement("Prestige C");
  if(game.prestige >= 500)  unlockAchievement("Prestige D");

  // Niveaux
  if(game.level >= 200)    unlockAchievement("niveau 200");
  if(game.level >= 300)    unlockAchievement("niveau 300");
  if(game.level >= 500)    unlockAchievement("niveau 500");
  if(game.level >= 1000)   unlockAchievement("niveau 1000");
  if(game.level >= 5000)   unlockAchievement("niveau 5000");
  if(game.level >= 10000)   unlockAchievement("niveau 10000");

  // CPS
  if(game.cps >=1000)      unlockAchievement("1K CPS");
  if(game.cps >=10000)     unlockAchievement("10K CPS");
  if(game.cps >=50000)     unlockAchievement("50K CPS");
  if(game.cps >=100000)    unlockAchievement("100K CPS");
  if(game.cps >=500000)    unlockAchievement("500K CPS");

  // ğŸ–±ï¸ SuccÃ¨s clics
  if(game.totalClicks >= 1000)       unlockAchievement("1K Clics");
  if(game.totalClicks >= 10000)      unlockAchievement("10K Clics");
  if(game.totalClicks >= 100000)     unlockAchievement("100K Clics");
  if(game.totalClicks >= 1000000)    unlockAchievement("1M Clics");
  if(game.totalClicks >= 10000000)   unlockAchievement("10M Clics");
  if(game.totalClicks >= 100000000)  unlockAchievement("100M Clics");

  // ğŸ¯ VÃ©rifie si tous les succÃ¨s sont obtenus (sauf le SuprÃªme lui-mÃªme)
  let allDone = true;
  for(const category in allAchievements){
    allAchievements[category].forEach(name=>{
      if(name !== "SuccÃ¨s SuprÃªme" && !game.achievements.includes(name)){
        allDone = false;
      }
    });
  }
  if(allDone){
    unlockAchievement("SuccÃ¨s SuprÃªme");
  }
}

// Easter egg : clic sur lâ€™icÃ´ne du titre
document.getElementById("pickaxeIconTitle").addEventListener("click", ()=>{
  unlockAchievement("Easter Egg");
});

// âœ… Affichage triÃ© et colorÃ© des succÃ¨s
function renderAchievementsList(){
  const ul = document.getElementById("achList");
  ul.innerHTML = "";

  for(const category in allAchievements){
    // CatÃ©gorie
    const catLi = document.createElement("li");
    catLi.textContent = "ğŸ“‚ " + category;
    catLi.style.fontWeight = "bold";
    catLi.style.marginTop = "10px";
    ul.appendChild(catLi);

    // SuccÃ¨s de la catÃ©gorie
    allAchievements[category].forEach(name => {
      const li = document.createElement("li");
      li.style.marginLeft = "20px";

      if(name === "Easter Egg" && !game.achievements.includes("Easter Egg")){
        // ğŸ”’ Easter Egg cachÃ©
        li.textContent = "???";
        li.style.color = "gray";

      } else {
        li.textContent = name;

        if(game.achievements.includes(name)){
          li.style.fontWeight = "bold";

          // ğŸ¨ Couleurs spÃ©ciales
          switch(name){
            case "Pioche en pierre":   li.style.color = "#888"; break;     // gris pierre
            case "Pioche en fer":      li.style.color = "#bbb"; break;     // argentÃ©
            case "Pioche en or":       li.style.color = "gold"; break;     // dorÃ©
            case "Pioche en diamant":  li.style.color = "#7fd6ff"; break;  // bleu diamant
            case "Pioche en rubis":    li.style.color = "red"; break;      // rouge rubis

            case "SuccÃ¨s SuprÃªme":     // ğŸŒˆ Multicolore
              li.style.background = "linear-gradient(to right, red, orange, yellow, green, blue, indigo, violet)";
              li.style.webkitBackgroundClip = "text";
              li.style.webkitTextFillColor = "transparent";
              li.style.fontWeight = "bold";
              break;

            default: li.style.color = "limegreen"; // âœ… vert par dÃ©faut
          }

        } else {
          // ğŸš« pas encore obtenu
          li.style.color = "lightgray";
        }
      }

      ul.appendChild(li);
    });
  }
}

// âš¡ Affiche la liste au dÃ©marrage
renderAchievementsList();

  /* ================== Mise Ã  jour dynamique du texte Prestige ================== */
function updatePrestigeUI(){
  const requiredLevel = Math.floor(100 * Math.pow(1.3, game.prestige)); // niveau requis dynamique
  document.getElementById("prestigeReqText").textContent = "Niveau requis : " + requiredLevel;
  document.getElementById("prestigeCostText").textContent = "CoÃ»t : " + formatNumber(game.prestigeCost) + " minerais";
}


/* ================== PRESTIGE ================== */
document.getElementById("prestigeBtn").addEventListener("click", ()=>{
  const requiredLevel = Math.floor(100 * Math.pow(1.3, game.prestige)); // palier dynamique corrigÃ©
  const canPrestige = (game.level >= requiredLevel && game.totalCoins >= game.prestigeCost);
  if(!canPrestige) return;

  // Ajout dâ€™un niveau de prestige
  game.prestige += 1;
  game.multiplier = (1 + game.prestige * 0.2) * calcAchievementsMultiplier();

  // Reset des ressources et progression
  game.cookies = 0;
  game.totalCoins = 0;
  game.cps = 0;
  game.level = 1;

  // ğŸ”¥ Augmentation du coÃ»t du prestige (x1.3 Ã  chaque fois)
  game.prestigeCost = Math.floor(game.prestigeCost * 1.3);

  // Reset boutique
  for(const key in game.upgrades){
    game.upgrades[key].count = 0;
    game.upgrades[key].unlocked = (key === "bonnepioche");

    // prix de base de chaque amÃ©lioration
    if(key === "bonnepioche") game.upgrades[key].price = 20;
    if(key === "mine") game.upgrades[key].price = 200;
    if(key === "foreuse") game.upgrades[key].price = 1000;
    if(key === "ouvrier") game.upgrades[key].price = 5000;
    if(key === "tnt") game.upgrades[key].price = 25000;
    if(key === "nain") game.upgrades[key].price = 75000;
    if(key === "grossetnt") game.upgrades[key].price = 125000;
    if(key === "exosquelette") game.upgrades[key].price = 250000;
    if(key === "foreuselaser") game.upgrades[key].price = 500000;
    if(key === "golem") game.upgrades[key].price = 1000000;
    if(key === "drillnuke") game.upgrades[key].price = 1500000;
    if(key === "army") game.upgrades[key].price = 2250000;
    if(key === "divinepick") game.upgrades[key].price = 4000000;
  }

  // Reset forge
  game.forge.crit.count = 0; game.forge.crit.price = 5000;
  game.forge.rare.count = 0; game.forge.rare.price = 10000;
  game.forge.pickaxe.stage = 0;
  if(game.forge.metal){ game.forge.metal.count = 0; game.forge.metal.price = 50000; }
  if(game.forge.affutage){ game.forge.affutage.count = 0; game.forge.affutage.price = 150000; }

  // Reset pioche
  game.pickaxe = {type:"wood"};

  // Reset investissements (actions)
  game.investments.forEach(inv=>{
    inv.owned = 0;
    inv.price = inv.basePrice; // retourne Ã  son prix de dÃ©part
  });

  // Mets Ã  jour tout lâ€™affichage
  recalcLevel();
  buildShop();
  buildForge();
  buildInvest();
  updateUI();
  updatePrestigeUI(); // ğŸ‘ˆ important pour changer le texte requis + coÃ»t
});

   /* ================== DEBUG MODE ================== */
let secretInput = "";

function activateDebugMode(){
  document.getElementById("debugPanel").style.display = "block";
  document.getElementById("dbgMessage").style.display = "block"; // message rouge
}

function checkCasinoSecret(number){
  if(number.toString() === "25042007"){
    activateDebugMode();
    return true; // secret trouvÃ©
  }
  return false;
}

// Fermer avec N
document.addEventListener("keydown", (e)=>{
  if(e.key.toLowerCase() === "n"){
    document.getElementById("debugPanel").style.display = "none";
  }
});

// Boutons Debug
document.getElementById("dbgAdd10M").addEventListener("click", ()=>{
  game.cookies += 10_000_000;
  game.totalCoins += 10_000_000;
  updateUI();
});

document.getElementById("dbgLvl1000").addEventListener("click", ()=>{
  game.level = 1000;
  recalcLevel();
  updateUI();
});

document.getElementById("dbgUnlockShop").addEventListener("click", ()=>{
  for(const key in game.upgrades){
    game.upgrades[key].unlocked = true;
  }
  updateUI();
});

function debugAchievements(category){
  if(allAchievements[category]){
    allAchievements[category].forEach(name=>{
      unlockAchievement(name);
    });
    updateUI();
  }
  // Quand debug est activÃ©
function enableDebugMode(){
  game.debugMode = true; // ğŸš« exclut du classement
  alert("âš ï¸ Debug mode activÃ©. Tu es exclu du classement !");
}

}

    /* ================== DÃ‰MARRAGE ================== */
    window.addEventListener("load", ()=>{
  loadGame();     
  updateUI();
  updatePrestigeUI();
  setInterval(tick, 1000);
  buildInvest();   // ğŸ‘ˆ ici
  updateLeaderboard();
  if (!game.pseudo) game.pseudo = "";
if (game.inLeaderboard === undefined) game.inLeaderboard = true;
});


/* ================== INVESTISSEMENTS ================== */
function buildInvest() {
  const invest = document.getElementById("investContent");
  document.getElementById("oreDisplayInvest").textContent =
    "ğŸ’ Minerais: " + formatNumber(game.cookies);
  invest.innerHTML = "";

  game.investments.forEach((inv, index) => {
    const div = document.createElement("div");
    div.className = "upgrade"; // applique le style de tes autres cartes

    div.innerHTML = `
  <strong>${inv.name}</strong><br>
  Prix actuel: ${formatNumber(inv.price)} minerais<br>
  PossÃ©dÃ©es: ${inv.owned}<br>
  <button class="buyBtn" ${game.cookies < inv.price ? "disabled" : ""}>Acheter</button>
  <button class="sellBtn" ${inv.owned <= 0 ? "disabled" : ""}>Vendre</button><br>
  <button class="buyMaxBtn" ${game.cookies < inv.price ? "disabled" : ""}>Acheter Max</button>
  <button class="sellAllBtn" ${inv.owned <= 0 ? "disabled" : ""}>Vendre Tout</button>
`;

    // Acheter
    div.querySelector(".buyBtn").addEventListener("click", () => {
      if (game.cookies >= inv.price) {
        game.cookies -= inv.price;
        inv.owned++;
        buildInvest();
        updateUI();
      }
    });

    // Vendre
    div.querySelector(".sellBtn").addEventListener("click", () => {
      if (inv.owned > 0) {
        game.cookies += inv.price;
        inv.owned--;
        buildInvest();
        updateUI();
      }
    });

    // Acheter Max
div.querySelector(".buyMaxBtn").addEventListener("click", () => {
  let maxBuy = Math.floor(game.cookies / inv.price);
  if(maxBuy > 0){
    game.cookies -= inv.price * maxBuy;
    inv.owned += maxBuy;
    buildInvest();
    updateUI();
  }
});

// Vendre Tout
div.querySelector(".sellAllBtn").addEventListener("click", () => {
  if(inv.owned > 0){
    game.cookies += inv.price * inv.owned;
    inv.owned = 0;
    buildInvest();
    updateUI();
  }
});


    invest.appendChild(div);
  });
}

// Mise Ã  jour automatique des prix (pile ou face 50/50)
setInterval(() => {
  game.investments.forEach(inv => {
    let variation;

    if (Math.random() < 0.5) {
      // 50% de chance de monter : entre +0% et +5%
      variation = Math.random() * 0.05;
    } else {
      // 50% de chance de descendre : entre -0% et -5%
      variation = -(Math.random() * 0.05);
    }

    // nouveau prix
    let newPrice = Math.floor(inv.price * (1 + variation));

    // empÃªche de descendre en dessous de 50% du prix de dÃ©part
    newPrice = Math.max(inv.basePrice * 0.5, newPrice);

    inv.price = newPrice;
  });
  buildInvest();
}, 5000);


// === Initialisation des graphes ===
const ctxMine = document.getElementById("graphMine").getContext("2d");
const ctxForeuse = document.getElementById("graphForeuse").getContext("2d");
const ctxTNT = document.getElementById("graphTNT").getContext("2d");

const charts = {
  mine: new Chart(ctxMine, {
    type: "line",
    data: { labels: [], datasets: [{ label: "Mine locale", data: [], borderColor: "cyan", fill: false }] },
    options: { responsive: true, scales: { x: { display: false } } }
  }),
  foreuse: new Chart(ctxForeuse, {
    type: "line",
    data: { labels: [], datasets: [{ label: "Compagnie de foreuses", data: [], borderColor: "orange", fill: false }] },
    options: { responsive: true, scales: { x: { display: false } } }
  }),
  tnt: new Chart(ctxTNT, {
    type: "line",
    data: { labels: [], datasets: [{ label: "SociÃ©tÃ© TNT Mining", data: [], borderColor: "red", fill: false }] },
    options: { responsive: true, scales: { x: { display: false } } }
  })
};

// === Mise Ã  jour toutes les 5 secondes (en mÃªme temps que la variation des prix) ===
setInterval(() => {
  game.investments.forEach((inv, i) => {
    let label = new Date().toLocaleTimeString().slice(0,8);
    if(i===0){
      charts.mine.data.labels.push(label);
      charts.mine.data.datasets[0].data.push(inv.price);
      charts.mine.update();
    }
    if(i===1){
      charts.foreuse.data.labels.push(label);
      charts.foreuse.data.datasets[0].data.push(inv.price);
      charts.foreuse.update();
    }
    if(i===2){
      charts.tnt.data.labels.push(label);
      charts.tnt.data.datasets[0].data.push(inv.price);
      charts.tnt.update();
    }
  });
}, 5000);

</script>
<script type="module">
  // === Import Firebase ===
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-analytics.js";
  import { 
    getFirestore, collection, setDoc, doc, getDocs, query, orderBy, deleteDoc 
  } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";

  // === Configuration Firebase ===
  const firebaseConfig = {
    apiKey: "AIzaSyCbwh2LiYMIodVCdEaPcNEC5vg-oN9p7ZY",
    authDomain: "clicker-miner.firebaseapp.com",
    projectId: "clicker-miner",
    storageBucket: "clicker-miner.firebasestorage.app",
    messagingSenderId: "1033830475796",
    appId: "1:1033830475796:web:fba1c697c6858cf29f9f01",
    measurementId: "G-7XGL6MJDK3"
  };

  // === Initialisation ===
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
  const db = getFirestore(app);

  // === SYNC LEADERBOARD ===
  async function syncLeaderboard() {
    if (!game.pseudo) return;

    try {
      if (!game.inLeaderboard) {
        // ğŸš« supprime du classement si debug
        await deleteDoc(doc(db, "leaderboard", game.pseudo));
        return;
      }

      // âœ… sinon on met Ã  jour normalement
      await setDoc(doc(db, "leaderboard", game.pseudo), {
        pseudo: game.pseudo,
        prestige: Math.floor(game.prestige),      // entier
        totalCoins: Math.floor(game.totalCoins),  // entier
        updatedAt: Date.now()
      });
    } catch (e) {
      console.error("Sync leaderboard error:", e);
    }
  }

  // === SYNC Ã€ CHAQUE SAUVEGARDE ===
  const oldSaveGame = window.saveGame;
  window.saveGame = function (manual = false) {
    oldSaveGame(manual);
    syncLeaderboard();
  };

  // === Bouton pseudo ===
  document.getElementById("pseudoBtn").addEventListener("click", async () => {
    const p = document.getElementById("pseudoInput").value.trim();
    if (p.length < 3) {
      alert("âš ï¸ Le pseudo doit avoir au moins 3 caractÃ¨res !");
      return;
    }

    // VÃ©rifier si le pseudo existe dÃ©jÃ 
    const qs = await getDocs(collection(db, "leaderboard"));
    let exists = false;
    qs.forEach(snap => {
      if (snap.id === p) exists = true;
    });

    if (exists) {
      alert("âš ï¸ Ce pseudo est dÃ©jÃ  utilisÃ©, choisis-en un autre !");
      return;
    }

    game.pseudo = p;
    document.getElementById("pseudoDisplay").textContent = "Votre pseudo : " + p;
    document.getElementById("pseudoBox").style.display = "none"; // cache le champ
    saveGame(); // sauvegarde avec pseudo

    await syncLeaderboard();
    loadLeaderboard();
  });

  // === Charger le classement ===
async function loadLeaderboard() {
  const ul = document.getElementById("leaderboardList");
  if (!ul) return;
  ul.innerHTML = "Chargement...";

  try {
    const q = query(collection(db, "leaderboard"), orderBy("prestige", "desc"));
    const qs = await getDocs(q);
    ul.innerHTML = "";
    let rank = 1;
    qs.forEach(snap => {
      const d = snap.data();
      const li = document.createElement("li");
      li.textContent = `#${rank++} ${d.pseudo} â€” Prestige : ${formatNumber(d.prestige)} â€” Minerais : ${formatNumber(d.totalCoins)}`;
      ul.appendChild(li);
    });
  } catch (e) {
    console.error(e);
    ul.innerHTML = "Erreur de chargement du classement.";
  }
  function activateDebugMode() {
  // ... ton code dâ€™ouverture de panel
  game.inLeaderboard = false; // â›” sort du classement
  syncLeaderboard();          // âš¡ supprime direct du classement Firebase
}

}


  // === AUTO REFRESH CLASSEMENT TOUTES LES 3s ===
  setInterval(() => {
    syncLeaderboard();   // âš¡ envoie les nouvelles valeurs du joueur
    loadLeaderboard();   // âš¡ recharge le classement
  }, 3000);

  // === Charger au dÃ©marrage ===
  loadLeaderboard();
</script>

</body>
</html>