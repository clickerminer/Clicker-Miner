<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Clicker Miner</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=MedievalSharp&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <!-- Sidebar -->
  <div class="sidebar">
    <button class="tab-btn active" data-tab="miner">⚒ Miner</button>
    <button class="tab-btn" data-tab="shop">🏪 Boutique</button>
    <button class="tab-btn" data-tab="forge">🔥 Forge</button>
    <button class="tab-btn" data-tab="achievements">🏆 Succès</button>
    <button class="tab-btn" data-tab="casino">🎰 Casino</button>
    <button class="tab-btn" data-tab="prestigeTab">💎 Prestige</button>
    <button class="tab-btn" data-tab="investTab">📈 Investissements</button>
  </div>

  <!-- Contenu -->
  <div class="content">
    <h1><span id="pickaxeIconTitle">⛏</span> Clicker Miner</h1>

    <!-- Bloc pioche + stats (toujours visible) -->
<div class="miner-fixed">
  <div id="pickaxeName">Pioche en bois</div>
  <div id="pickaxe">⛏</div>

  <div class="stats">
  <div>💎 Minerais : <span id="cookies">0</span></div>
  <div>Total : <span id="totalCoins">0</span></div>
  <div>⛏️ Par clic : <span id="perClick">1</span></div>
  <div>⚡ CPS : <span id="cps">0</span></div>
  <div>🆙 Niveau : <span id="level">1</span></div>
  <div>🌟 Prestige : <span id="prestigeCount">0</span></div>
  <div>🔮 Multiplicateur : <span id="multiplier">1.00</span></div>
</div>


<!-- Onglet Miner (vide maintenant, ou tu peux mettre un petit texte si tu veux) -->
<div id="miner" class="tab-content active-tab">

</div>


    <!-- Onglet Boutique -->
    <div id="shop" class="tab-content">
      <div id="oreDisplayShop" class="oreDisplay">💎 Minerais: 0</div>
      <div id="shopContent" class="grid"></div>
    </div>

    <!-- Onglet Forge -->
    <div id="forge" class="tab-content">
      <div id="oreDisplayForge" class="oreDisplay">💎 Minerais: 0</div>
      <div id="forgeContent" class="grid"></div>
    </div>

    <!-- Onglet Succès -->
    <div id="achievements" class="tab-content">
      <div>
        <strong>Succès débloqués :</strong>
        <ul id="achList"></ul>
      </div>
    </div>

    <!-- Onglet Casino -->
    <div id="casino" class="tab-content">
      <div class="casino-container">
        <h2>🎰 Casino</h2>
        <p>Mise un montant de minerais et tente ta chance !</p>
        <input type="number" id="betAmount" placeholder="Montant à miser" min="1">
        <button id="betBtn">Miser</button>
        <p id="casinoResult"></p>
      </div>
    </div>

    <!-- Onglet Prestige -->
<div id="prestigeTab" class="tab-content">
  <div class="prestige-actions special-buttons">
    <button id="prestigeBtn">
      🌟 Prestige<br>
      <span id="prestigeReqText">Niveau requis : 100</span><br>
      <span id="prestigeCostText">Coût : 1M minerais</span>
    </button>
  </div>
</div>

  <!-- Panneau Debug (Shift+D) -->
  <div id="debugPanel" class="debug-panel">
    <div class="debug-title">🐞 Debug</div>
    <button id="dbgAdd10k">+100k minerais</button>
    <button id="dbgUnlock">Débloquer boutique</button>
    <button id="dbgDiamond">Pioche diamant</button>
    <small>(Shift+D pour fermer)</small>
  </div>
   <!-- Onglet Investissements -->
<div id="investTab" class="tab-content">
  <div id="investContent"></div>
  <div id="oreDisplayInvest" class="oreDisplay">💎 Minerais: 0</div>
  <div id="investGraphs">
    <canvas id="graphMine"></canvas>
    <canvas id="graphForeuse"></canvas>
    <canvas id="graphTNT"></canvas>
  </div>
</div>

<div id="saveControls">
  <button id="saveBtn">💾 Sauvegarder</button>
  <button id="resetBtn">♻️ Réinitialiser</button>
</div>


  <script>
    /* ================== ÉTAT DU JEU ================== */
    let game = {
      cookies: 0,
      totalCoins: 0,
      cps: 0,
      level: 1,
      prestige: 0,
      multiplier: 1.0,
      totalClicks: 0,
      prestigeCost: 1000000,
      pickaxe: {type:"wood"},
      upgrades: {
        bonnepioche: {key:"bonnepioche", name:"Bonne Pioche", desc:"+2 cps.",   cps:2,   price:20,   count:0, unlocked:true},
        mine:        {key:"mine",        name:"Mine",         desc:"+4 cps.",   cps:4,   price:200,  count:0, unlocked:false},
        foreuse:     {key:"foreuse",     name:"Foreuse",      desc:"+10 cps.",  cps:10,  price:1000, count:0, unlocked:false},
        ouvrier:     {key:"ouvrier",     name:"Ouvrier",      desc:"+20 cps.",  cps:20,  price:5000, count:0, unlocked:false},
        tnt:         {key:"tnt",         name:"TNT",          desc:"+40 cps.",  cps:40,  price:25000,count:0, unlocked:false},
        nain:        {key:"nain",        name:"Nain",         desc:"+70 cps.",  cps:70,  price:75000,count:0, unlocked:false},
        grossetnt:   {key:"grossetnt",   name:"Grosse TNT",   desc:"+90 cps.", cps:90, price:125000, count:0, unlocked:false},
        exosquelette:{key:"exosquelette",name:"Exosquelette", desc:"+200 cps.", cps:200, price:250000, count:0, unlocked:false},
        foreuselaser:{key:"foreuselaser",name:"Foreuse laser",desc:"+500 cps.", cps:500, price:500000, count:0, unlocked:false},
        golem:       {key:"golem",       name:"Golem de pierre",  desc:"+750 cps.",   cps:750,  price:1000000, count:0, unlocked:false},
        drillnuke:   {key:"drillnuke",   name:"Drill nucléaire",  desc:"+1250 cps.",  cps:1250, price:1500000, count:0, unlocked:false},
        army:        {key:"army",        name:"Armée de nains",   desc:"+2000 cps.",  cps:2000, price:2250000, count:0, unlocked:false},
        divinepick:  {key:"divinepick",  name:"Pioche divine",    desc:"+3500 cps.",  cps:3500, price:4000000, count:0, unlocked:false}


      },
      forge: {
        crit:{name:"Coup Critique",desc:"2% par niveau (max 20%) → x3 au clic.", price:5000,  count:0},
        rare:{name:"Minerai Rare", desc:"1% par niveau (max 10%) → x5 au clic.", price:10000, count:0},
        pickaxe:{stage:0}
      },
            achievements:[],
      investments: [
  { name: "Mine locale",           price: 1000,  basePrice: 1000,  owned: 0 },
  { name: "Compagnie de foreuses", price: 5000,  basePrice: 5000,  owned: 0 },
  { name: "Société TNT Mining",    price: 20000, basePrice: 20000, owned: 0 }
]

      
    };
    function formatNumber(num){
      num = Math.floor(num);
      if(num >=1e12) return (num/1e12).toFixed(2) + "T";
      if(num >= 1e9) return (num/1e9).toFixed(2) + "B";
      if(num >= 1e6) return (num/1e6).toFixed(2) + "M";
     if(num >= 1e3) return (num/1e3).toFixed(2) + "K";
     return num.toString();
  }

// ✅ Calcul du bonus permanent des succès (0.2% par succès)
function calcAchievementsMultiplier() {
  return 1 + (game.achievements.length * 0.002);
}


    const pickaxes = [
      {key:"wood",    name:"Pioche en bois",    power:1,  color:"saddlebrown"},
      {key:"stone",   name:"Pioche en pierre",  power:2,  color:"#444",   price:10000},
      {key:"iron",    name:"Pioche en fer",     power:5,  color:"#bbb",   price:50000},
      {key:"gold",    name:"Pioche en or",      power:9,  color:"gold",   price:150000},
      {key:"diamond", name:"Pioche en diamant", power:15, color:"#7fd6ff",price:500000}
    ];
  game.totalClicks = (game.totalClicks || 0) + 1;

    /* ================== SAUVEGARDE ================== */
function saveGame(){
  localStorage.setItem("clickerMinerSave", JSON.stringify(game));
  alert("✅ Sauvegarde effectuée !");
}

function loadGame(){
  const save = localStorage.getItem("clickerMinerSave");
  if(save){
    game = JSON.parse(save);

    // ⚡ remet à jour l’affichage
    buildShop();
    buildForge();
    buildInvest();
    updateUI();
    updatePrestigeUI();
  }
}

function resetGame(){
  if(confirm("⚠️ Es-tu sûr de vouloir réinitialiser ta partie ?")){
    localStorage.removeItem("clickerMinerSave");
    location.reload();
  }
}

/* ================== BOUTONS ================== */
document.getElementById("saveBtn").addEventListener("click", saveGame);
document.getElementById("resetBtn").addEventListener("click", resetGame);

/* ================== AUTO-SAVE ================== */
setInterval(saveGame, 120000);

    /* ================== OUTILS ================== */
    function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }
    function findPick(){ return pickaxes.find(p=>p.key===game.pickaxe.type); }
    function perClickBase(){ return findPick().power * game.multiplier; }

    /* ================== BOUTIQUE ================== */
   function buildShop(){
  const shop = document.getElementById("shopContent");
  document.getElementById("oreDisplayShop").textContent  = "💎 Minerais: " + formatNumber(game.cookies);
  shop.innerHTML = "";
  for(const key in game.upgrades){
    const up = game.upgrades[key];
    if(!up.unlocked) continue;
    const div = document.createElement("div");
    div.className = "upgrade";
    div.innerHTML = `
      <strong>${up.name}</strong><br>
      <small>${up.desc}</small><br>
      +${up.cps} cps<br>
      Prix: ${formatNumber(up.price)}<br>
      Achetés: ${up.count}<br>
      <button ${game.cookies<up.price?"disabled":""}>Acheter</button>
    `;
    div.querySelector("button").addEventListener("click", ()=>{
      if(game.cookies < up.price) return;
      game.cookies -= up.price;
      up.count++;
      game.cps += up.cps;

      // Déblocages à 5
      if(key==="bonnepioche" && up.count>=5) game.upgrades.mine.unlocked = true;
      if(key==="mine"        && up.count>=5) game.upgrades.foreuse.unlocked = true;
      if(key==="foreuse"     && up.count>=5) game.upgrades.ouvrier.unlocked = true;
      if(key==="ouvrier"     && up.count>=5) game.upgrades.tnt.unlocked = true;
      if(key==="tnt"         && up.count>=5) game.upgrades.nain.unlocked = true;
      if(key==="nain"        && up.count>=5) game.upgrades.grossetnt.unlocked = true;      
      if(key==="grossetnt"   && up.count>=5) game.upgrades.exosquelette.unlocked = true;   
      if(key==="exosquelette"&& up.count>=5) game.upgrades.foreuselaser.unlocked = true;


      // Nouvelle formule de prix progressive
      const baseIncrease = 1.15; 
      const dynamicMultiplier = baseIncrease + (up.count * 0.01); 
      up.price = Math.floor(up.price * dynamicMultiplier);

      buildShop();
      updateUI();
    });
    shop.appendChild(div);
  }

}

    /* ================== FORGE ================== */
function buildForge(){
  const forge = document.getElementById("forgeContent");
  document.getElementById("oreDisplayForge").textContent = "💎 Minerais: " + formatNumber(game.cookies);
  forge.innerHTML = "";

  // Coup Critique
  const crit = game.forge.crit;
  const critChance = clamp(crit.count * 2, 0, 20);
  const divCrit = document.createElement("div");
  divCrit.className = "upgrade";
  divCrit.innerHTML = `
    <strong>${crit.name}</strong><br>
    <small>${crit.desc} (Actuel: ${critChance}%)</small><br>
    Prix: ${formatNumber(crit.price)}<br>
    Niveau: ${crit.count}<br>
    <button ${game.cookies<crit.price || critChance>=20 ? "disabled":""}>Améliorer</button>
  `;
  divCrit.querySelector("button").addEventListener("click", ()=>{
    if(game.cookies < crit.price || critChance>=20) return;
    game.cookies -= crit.price;
    crit.count++;
    crit.price = Math.floor(crit.price * 1.5);
    buildForge();
    updateUI();
  });
  forge.appendChild(divCrit);

  // Minerai Rare
  const rare = game.forge.rare;
  const rareChance = clamp(rare.count * 1, 0, 10);
  const divRare = document.createElement("div");
  divRare.className = "upgrade";
  divRare.innerHTML = `
    <strong>${rare.name}</strong><br>
    <small>${rare.desc} (Actuel: ${rareChance}%)</small><br>
    Prix: ${formatNumber(rare.price)}<br>
    Niveau: ${rare.count}<br>
    <button ${game.cookies<rare.price || rareChance>=10 ? "disabled":""}>Améliorer</button>
  `;
  divRare.querySelector("button").addEventListener("click", ()=>{
    if(game.cookies < rare.price || rareChance>=10) return;
    game.cookies -= rare.price;
    rare.count++;
    rare.price = Math.floor(rare.price * 1.5);
    buildForge();
    updateUI();
  });
  forge.appendChild(divRare);

  // 🔥 Durcissement du métal (NOUVEAU)
  if(!game.forge.metal) game.forge.metal = {name:"Durcissement du métal",desc:"+2% de CPS global par niveau", price:50000, count:0};
  const metal = game.forge.metal;
  const divMetal = document.createElement("div");
  divMetal.className = "upgrade";
  divMetal.innerHTML = `
    <strong>${metal.name}</strong><br>
    <small>${metal.desc}</small><br>
    Prix: ${formatNumber(metal.price)}<br>
    Niveau: ${metal.count}/50<br>
    <button ${game.cookies<metal.price || metal.count>=50 ? "disabled":""}>Améliorer</button>
  `;
  divMetal.querySelector("button").addEventListener("click", ()=>{
    if(game.cookies < metal.price || metal.count>=50) return;
    game.cookies -= metal.price;
    metal.count++;
    game.cps *= 1.02; // +2% CPS
    metal.price = Math.floor(metal.price * 1.3);
    buildForge();
    updateUI();
  });
  forge.appendChild(divMetal);

  // ⚡ Double affûtage (NOUVEAU)
  if(!game.forge.affutage) game.forge.affutage = {name:"Double affûtage",desc:"+5% par clic", price:150000, count:0};
  const aff = game.forge.affutage;
  const divAff = document.createElement("div");
  divAff.className = "upgrade";
  divAff.innerHTML = `
    <strong>${aff.name}</strong><br>
    <small>${aff.desc}</small><br>
    Prix: ${formatNumber(aff.price)}<br>
    Niveau: ${aff.count}/40<br>
    <button ${game.cookies<aff.price || aff.count>=40 ? "disabled":""}>Améliorer</button>
  `;
  divAff.querySelector("button").addEventListener("click", ()=>{
    if(game.cookies < aff.price || aff.count>=40) return;
    game.cookies -= aff.price;
    aff.count++;
    game.multiplier *= 1.05; // +5% clics
    aff.price = Math.floor(aff.price * 1.4);
    buildForge();
    updateUI();
  });
  forge.appendChild(divAff);

  // ================== Pioche Upgrade ==================
  let pickaxeDiv = document.createElement("div");
  pickaxeDiv.className = "upgrade pickaxe-upgrade";

  const pickaxeStages = pickaxes.slice(1); // on saute bois

  if(game.forge.pickaxe.stage < pickaxeStages.length){
    let next = pickaxeStages[game.forge.pickaxe.stage];
    pickaxeDiv.innerHTML = `
      <strong>${next.name}</strong><br>
      Améliore ta pioche actuelle<br>
      Donne ${next.power} minerais/clic<br>
      Prix: ${formatNumber(next.price)}<br>
      <button ${game.cookies < next.price ? "disabled":""}>Acheter</button>
    `;
    pickaxeDiv.querySelector("button").addEventListener("click",()=>{
      if(game.cookies >= next.price){
        game.cookies -= next.price;
        game.pickaxe.type = next.key;
        game.forge.pickaxe.stage++;
        updateUI();
        buildForge();
      }
    });
  } else {
    pickaxeDiv.innerHTML = "<strong>⚒ Pioche max atteinte !</strong>";
  }

  forge.appendChild(pickaxeDiv);
}

    /* ================== CLIC ================== */
// Anti-autoclicker variables
let clickTimestamps = [];

document.getElementById("pickaxe").addEventListener("click", ()=>{
  const now = Date.now();

  // On garde seulement les clics de la dernière seconde
  clickTimestamps = clickTimestamps.filter(ts => now - ts < 1000);
  clickTimestamps.push(now);

  if(clickTimestamps.length > 20){
    // Trop de clics → on ignore ce clic
    console.warn("⛔ Anti-autoclick activé : trop de clics !");
    return;
  }

  const base = perClickBase();
  let gain = base;

  const critChance = clamp(game.forge.crit.count * 2, 0, 20);
  const rareChance = clamp(game.forge.rare.count * 1, 0, 10);

  if(Math.random()*100 < critChance) gain *= 3;
  if(Math.random()*100 < rareChance) gain *= 5;

  game.cookies += gain;
  game.totalCoins += gain;
  game.totalClicks = (game.totalClicks || 0) + 1;
  recalcLevel();
  checkAchievements();
  updateUI();
});

    /* ================== TABS ================== */
    document.querySelectorAll(".tab-btn").forEach(btn=>{
      btn.addEventListener("click",()=>{
        document.querySelectorAll(".tab-btn").forEach(b=>b.classList.remove("active"));
        btn.classList.add("active");
        document.querySelectorAll(".tab-content").forEach(div=>div.classList.remove("active-tab"));
        document.getElementById(btn.dataset.tab).classList.add("active-tab");

            if (btn.dataset.tab === "investTab") { buildInvest(); }
      });
    });

    // ================== CASINO ==================
document.getElementById("betBtn").addEventListener("click", ()=>{
  const input = document.getElementById("betAmount");
  const result = document.getElementById("casinoResult");
  let bet = parseInt(input.value);

  if(isNaN(bet) || bet <= 0 || bet > game.cookies){
    result.textContent = "Mise invalide !";
    return;
  }

  let win = false;

  // 🎁 Bonus spécial : si le montant finit par 898 → victoire garantie
  if(bet % 1000 === 290){
    win = true;
  } else {
    // sinon → 50% de chance classique
    win = (Math.random() < 0.5);
  }

  if(win){
    game.cookies += bet;
    game.totalCoins += bet; // ✅ ajoute au total
    result.textContent = "🎉 Gagné ! Vous avez doublé votre mise.";
  } else {
    game.cookies -= bet;
    // pas besoin de modifier totalCoins car c'est une perte, pas un gain
    result.textContent = "😢 Perdu !";
  }

  updateUI();
});

    /* ================== UI & TICK ================== */
    function recalcLevel(){ game.level = Math.floor(Math.sqrt(game.totalCoins/100)) + 1; }

    function renderAchievementsList(){
      const ul = document.getElementById("achList");
      ul.innerHTML = "";
      game.achievements.forEach(n=>{
        const li = document.createElement("li");
        li.textContent = n;
        ul.appendChild(li);
      });
    }

    function updateUI(){
  document.getElementById("cookies").textContent = formatNumber(game.cookies);
  document.getElementById("totalCoins").textContent = formatNumber(game.totalCoins);
  document.getElementById("cps").textContent         = Math.floor(game.cps * game.multiplier);
  document.getElementById("perClick").textContent    = Math.floor(perClickBase());
  document.getElementById("level").textContent       = game.level;
  // Prestige (entier)
  document.getElementById("prestigeCount").textContent = game.prestige;

  // Multiplicateur (2 décimales, ex: 1.20)
  document.getElementById("multiplier").textContent  = game.multiplier.toFixed(2);


  const pick = findPick();
  document.getElementById("pickaxeName").textContent = pick.name;
  document.getElementById("pickaxeName").style.color = pick.color;
  document.getElementById("pickaxe").style.color     = pick.color;
  document.getElementById("pickaxeIconTitle").style.color = pick.color;

  buildShop();
  buildForge();
  renderAchievementsList();

  // ✅ Mets à jour le texte du bouton Prestige
  updatePrestigeUI();
}



    function tick(){
      const gain = game.cps * game.multiplier;
      if(gain>0){
        game.cookies += gain;
        game.totalCoins += gain;
        recalcLevel();
        checkAchievements();
        updateUI();
      }else{
        // mini refresh pour chiffres
        document.getElementById("cookies").textContent = Math.floor(game.cookies);
        document.getElementById("totalCoins").textContent = Math.floor(game.totalCoins);
        document.getElementById("perClick").textContent = Math.floor(perClickBase());
      }
    }

    /* ================== SUCCÈS ================== */

// ✅ Liste complète des succès triés par catégories
const allAchievements = {
  "Minerais cumulés": [
    "10K Minerais",
    "100K Minerais",
    "1M Minerais",
    "5M Minerais",
    "10M Minerais",
    "20M Minerais",
    "50M Minerais",
    "100M Minerais",
    "200M Minerais",
    "500M Minerais"


  ],
  "Pioches": [
    "Pioche en pierre",
    "Pioche en fer",
    "Pioche en or",
    "Pioche en diamant"
  ],
  "Prestige": [
    "Prestige II",
    "Prestige V",
    "Prestige X",
    "Prestige XX",
    "Prestige L"
  ],
  "Niveaux": [
    "niveau 200",
    "niveau 300",
    "niveau 500",
    "niveau 1000"
  ],
  "Production (CPS)": [
    "1K CPS",
    "10K CPS",
    "50K CPS",
    "100K CPS"
  ],
  "Cliques": [
  "1K Clics",
  "10K Clics",
  "100K Clics",
  "1M Clics",
  "10M Clics",
  "100M Clics"
],
  "Secrets": [
    "Easter Egg",
    "Succès Suprême"
  ]

};

function unlockAchievement(name){
  if(!game.achievements.includes(name)){
    game.achievements.push(name);
    renderAchievementsList();

    // 🎁 Bonus : chaque succès augmente le multiplicateur global de 2%
    game.multiplier *= 1.02;
  }
}

function checkAchievements(){
  // Minerais cumulés
  if(game.totalCoins >= 10_000)      unlockAchievement("10K Minerais");
  if(game.totalCoins >= 100_000)     unlockAchievement("100K Minerais");
  if(game.totalCoins >= 1_000_000)   unlockAchievement("1M Minerais");
  if(game.totalCoins >= 5_000_000)   unlockAchievement("5M Minerais");
  if(game.totalCoins >= 10_000_000)  unlockAchievement("10M Minerais");
  if(game.totalCoins >= 20_000_000)  unlockAchievement("20M Minerais");
  if(game.totalCoins >= 50_000_000)  unlockAchievement("50M Minerais");
  if(game.totalCoins >= 100_000_000)  unlockAchievement("100M Minerais");
  if(game.totalCoins >= 200_000_000)  unlockAchievement("200M Minerais");
  if(game.totalCoins >= 500_000_000)  unlockAchievement("500M Minerais");

  // Pioches
  if(game.pickaxe.type==="stone")   unlockAchievement("Pioche en pierre");
  if(game.pickaxe.type==="iron")    unlockAchievement("Pioche en fer");
  if(game.pickaxe.type==="gold")    unlockAchievement("Pioche en or");
  if(game.pickaxe.type==="diamond") unlockAchievement("Pioche en diamant");

  // Prestige
  if(game.prestige >= 2)  unlockAchievement("Prestige II");
  if(game.prestige >= 5)  unlockAchievement("Prestige V");
  if(game.prestige >= 10) unlockAchievement("Prestige X");
  if(game.prestige >= 20) unlockAchievement("Prestige XX");
  if(game.prestige >= 50) unlockAchievement("Prestige L");

  // Niveaux
  if(game.level >= 200) unlockAchievement("niveau 200");
  if(game.level >= 300) unlockAchievement("niveau 300");
  if(game.level >= 500) unlockAchievement("niveau 500");
  if(game.level >= 1000) unlockAchievement("niveau 1000");

  // CPS
  if(game.cps >=1000)  unlockAchievement("1K CPS");
  if(game.cps >=10000) unlockAchievement("10K CPS");
  if(game.cps >=50000) unlockAchievement("50K CPS");
  if(game.cps >=100000) unlockAchievement("100K CPS");

  // 🖱️ Succès clics
if(game.totalClicks >= 1000)    unlockAchievement("1K Clics");
if(game.totalClicks >= 10000)   unlockAchievement("10K Clics");
if(game.totalClicks >= 100000)  unlockAchievement("100K Clics");
if(game.totalClicks >= 1000000) unlockAchievement("1M Clics");
if(game.totalClicks >= 10000000) unlockAchievement("10M Clics");
if(game.totalClicks >= 100000000) unlockAchievement("100M Clics");

   // 🎯 Vérifie si tous les succès sont obtenus (sauf le Suprême lui-même)
let allDone = true;
for(const category in allAchievements){
  allAchievements[category].forEach(name=>{
    if(name !== "Succès Suprême" && !game.achievements.includes(name)){
      allDone = false;
    }
  });
}

if(allDone){
  unlockAchievement("Succès Suprême");
}


}

// Easter egg : clic sur l’icône du titre
document.getElementById("pickaxeIconTitle").addEventListener("click", ()=>{
  unlockAchievement("Easter Egg");
});

// ✅ Affichage trié et coloré des succès
function renderAchievementsList(){
  const ul = document.getElementById("achList");
  ul.innerHTML = "";

  for(const category in allAchievements){
    const catLi = document.createElement("li");
    catLi.textContent = "📂 " + category;
    catLi.style.fontWeight = "bold";
    catLi.style.marginTop = "10px";
    ul.appendChild(catLi);

    allAchievements[category].forEach(name => {
      const li = document.createElement("li");
      li.style.marginLeft = "20px";

      if(name === "Easter Egg" && !game.achievements.includes("Easter Egg")){
        li.textContent = "???"; // 🔒 caché
        li.style.color = "gray";
      } else {
        li.textContent = name;
        if(game.achievements.includes(name)){
  li.style.fontWeight = "bold";

  // 🎨 couleur spéciale pour les pioches
  switch(name){
    case "Pioche en pierre": li.style.color = "#888"; break;     // gris pierre
    case "Pioche en fer":    li.style.color = "#bbb"; break;     // argenté
    case "Pioche en or":     li.style.color = "gold"; break;     // doré
    case "Pioche en diamant":li.style.color = "#7fd6ff"; break;  // bleu diamant
    default: li.style.color = "limegreen"; // ✅ vert par défaut
      case "Succès Suprême": li.style.color = "green"; break; // ✨ spécial

  }

} else {
  li.style.color = "lightgray"; // ❌ pas encore
}

      }

      ul.appendChild(li);
    });
  }
}


   /* ================== Mise à jour dynamique du texte Prestige ================== */
function updatePrestigeUI(){
  const requiredLevel = Math.floor(100 * Math.pow(1.5, game.prestige)); // niveau requis dynamique
  document.getElementById("prestigeReqText").textContent = "Niveau requis : " + requiredLevel;
  document.getElementById("prestigeCostText").textContent = "Coût : " + formatNumber(game.prestigeCost) + " minerais";
}


/* ================== PRESTIGE ================== */
document.getElementById("prestigeBtn").addEventListener("click", ()=>{
  const requiredLevel = Math.floor(100 * Math.pow(1.5, game.prestige)); // palier dynamique
  const canPrestige = (game.level >= requiredLevel && game.totalCoins >= game.prestigeCost);
  if(!canPrestige) return;

  // Ajout d’un niveau de prestige
  game.prestige += 1;
  game.multiplier = (1 + game.prestige * 0.2) * calcAchievementsMultiplier();

  // Reset des ressources et progression
  game.cookies = 0;
  game.totalCoins = 0;
  game.cps = 0;
  game.level = 1;

  // 🔥 Augmentation du coût du prestige (x2 à chaque fois)
  game.prestigeCost = Math.floor(game.prestigeCost * 2);

  // Reset boutique
  for(const key in game.upgrades){
    game.upgrades[key].count = 0;
    game.upgrades[key].unlocked = (key === "bonnepioche");

    // prix de base de chaque amélioration
    if(key === "bonnepioche") game.upgrades[key].price = 20;
    if(key === "mine") game.upgrades[key].price = 200;
    if(key === "foreuse") game.upgrades[key].price = 1000;
    if(key === "ouvrier") game.upgrades[key].price = 5000;
    if(key === "tnt") game.upgrades[key].price = 25000;
    if(key === "nain") game.upgrades[key].price = 75000;
    if(key === "grossetnt") game.upgrades[key].price = 125000;
    if(key === "exosquelette") game.upgrades[key].price = 250000;
    if(key === "foreuselaser") game.upgrades[key].price = 500000;
    if(key === "golem") game.upgrades[key].price = 1000000;
    if(key === "drillnuke") game.upgrades[key].price = 1500000;
    if(key === "army") game.upgrades[key].price = 2250000;
    if(key === "divinepick") game.upgrades[key].price = 4000000;
  }

  // Reset forge
  game.forge.crit.count = 0; game.forge.crit.price = 5000;
  game.forge.rare.count = 0; game.forge.rare.price = 10000;
  game.forge.pickaxe.stage = 0;
  if(game.forge.metal){ game.forge.metal.count = 0; game.forge.metal.price = 50000; }
  if(game.forge.affutage){ game.forge.affutage.count = 0; game.forge.affutage.price = 150000; }

  // Reset pioche
  game.pickaxe = {type:"wood"};

  // Reset investissements (actions)
  game.investments.forEach(inv=>{
    inv.owned = 0;
    inv.price = inv.basePrice; // retourne à son prix de départ
  });

  // Mets à jour tout l’affichage
  recalcLevel();
  buildShop();
  buildForge();
  buildInvest();
  updateUI();
  updatePrestigeUI(); // 👈 important pour changer le texte requis + coût
});

    /* ================== DEBUG MODE (Shift+D) ================== */
    const dbg = document.getElementById("debugPanel");
    document.addEventListener("keydown", (e)=>{
      if(e.key.toLowerCase()==='d' && e.shiftKey){
        dbg.classList.toggle("show");
      }
    });
    document.getElementById("dbgAdd10k").addEventListener("click", ()=>{
      game.cookies += 100000; game.totalCoins += 100000; updateUI();
    });
    document.getElementById("dbgUnlock").addEventListener("click", ()=>{
      for(const k in game.upgrades) game.upgrades[k].unlocked = true;
      updateUI();
    });
    document.getElementById("dbgDiamond").addEventListener("click", ()=>{
      game.pickaxe.type = "diamond"; updateUI(); checkAchievements();
    });

    /* ================== DÉMARRAGE ================== */
    window.addEventListener("load", ()=>{
  loadGame();     
  updateUI();
  updatePrestigeUI();
  setInterval(tick, 1000);
  buildInvest();   // 👈 ici
});

   /* ================== DEBUG FUNCTIONS ================== */
function addMinerais(amount){
  game.cookies += amount;
  game.totalCoins += amount;
  updateUI();
}

function addPrestige(){
  game.prestige++;
  game.multiplier += 0.5;
  updateUI();
}

function unlockAllUpgrades(){
  for(let key in game.upgrades){
    game.upgrades[key].unlocked = true;
  }
  buildShop();
  updateUI();
}

/* ================== TOGGLE DEBUG MODE ================== */
document.addEventListener("keydown", (e)=>{
  if(e.key.toLowerCase() === "n"){  // appui sur T
    const panel = document.getElementById("debugPanel");
    panel.style.display = (panel.style.display === "none" ? "block" : "none");
  }
});
/* ================== INVESTISSEMENTS ================== */
function buildInvest() {
  const invest = document.getElementById("investContent");
  document.getElementById("oreDisplayInvest").textContent =
    "💎 Minerais: " + formatNumber(game.cookies);
  invest.innerHTML = "";

  game.investments.forEach((inv, index) => {
    const div = document.createElement("div");
    div.className = "upgrade"; // applique le style de tes autres cartes

    div.innerHTML = `
  <strong>${inv.name}</strong><br>
  Prix actuel: ${formatNumber(inv.price)} minerais<br>
  Possédées: ${inv.owned}<br>
  <button class="buyBtn" ${game.cookies < inv.price ? "disabled" : ""}>Acheter</button>
  <button class="sellBtn" ${inv.owned <= 0 ? "disabled" : ""}>Vendre</button><br>
  <button class="buyMaxBtn" ${game.cookies < inv.price ? "disabled" : ""}>Acheter Max</button>
  <button class="sellAllBtn" ${inv.owned <= 0 ? "disabled" : ""}>Vendre Tout</button>
`;

    // Acheter
    div.querySelector(".buyBtn").addEventListener("click", () => {
      if (game.cookies >= inv.price) {
        game.cookies -= inv.price;
        inv.owned++;
        buildInvest();
        updateUI();
      }
    });

    // Vendre
    div.querySelector(".sellBtn").addEventListener("click", () => {
      if (inv.owned > 0) {
        game.cookies += inv.price;
        inv.owned--;
        buildInvest();
        updateUI();
      }
    });

    // Acheter Max
div.querySelector(".buyMaxBtn").addEventListener("click", () => {
  let maxBuy = Math.floor(game.cookies / inv.price);
  if(maxBuy > 0){
    game.cookies -= inv.price * maxBuy;
    inv.owned += maxBuy;
    buildInvest();
    updateUI();
  }
});

// Vendre Tout
div.querySelector(".sellAllBtn").addEventListener("click", () => {
  if(inv.owned > 0){
    game.cookies += inv.price * inv.owned;
    inv.owned = 0;
    buildInvest();
    updateUI();
  }
});


    invest.appendChild(div);
  });
}

// Mise à jour automatique des prix (simule la bourse)
setInterval(() => {
  game.investments.forEach(inv => {
    // variation entre -15% et +20%
    let variation = (Math.random() * 0.08 - 0.03); 

    // nouveau prix
    let newPrice = Math.floor(inv.price * (1 + variation));

    // empêche de descendre en dessous de 50% du prix de départ
    newPrice = Math.max(inv.basePrice * 0.5, newPrice);

    inv.price = newPrice;
  });
  buildInvest();
}, 5000);

// === Initialisation des graphes ===
const ctxMine = document.getElementById("graphMine").getContext("2d");
const ctxForeuse = document.getElementById("graphForeuse").getContext("2d");
const ctxTNT = document.getElementById("graphTNT").getContext("2d");

const charts = {
  mine: new Chart(ctxMine, {
    type: "line",
    data: { labels: [], datasets: [{ label: "Mine locale", data: [], borderColor: "cyan", fill: false }] },
    options: { responsive: true, scales: { x: { display: false } } }
  }),
  foreuse: new Chart(ctxForeuse, {
    type: "line",
    data: { labels: [], datasets: [{ label: "Compagnie de foreuses", data: [], borderColor: "orange", fill: false }] },
    options: { responsive: true, scales: { x: { display: false } } }
  }),
  tnt: new Chart(ctxTNT, {
    type: "line",
    data: { labels: [], datasets: [{ label: "Société TNT Mining", data: [], borderColor: "red", fill: false }] },
    options: { responsive: true, scales: { x: { display: false } } }
  })
};

// === Mise à jour toutes les 5 secondes (en même temps que la variation des prix) ===
setInterval(() => {
  game.investments.forEach((inv, i) => {
    let label = new Date().toLocaleTimeString().slice(0,8);
    if(i===0){
      charts.mine.data.labels.push(label);
      charts.mine.data.datasets[0].data.push(inv.price);
      charts.mine.update();
    }
    if(i===1){
      charts.foreuse.data.labels.push(label);
      charts.foreuse.data.datasets[0].data.push(inv.price);
      charts.foreuse.update();
    }
    if(i===2){
      charts.tnt.data.labels.push(label);
      charts.tnt.data.datasets[0].data.push(inv.price);
      charts.tnt.update();
    }
  });
}, 5000);

  </script>
 <!-- ================== DEBUG MODE ================== -->
<div id="debugPanel" style="display:none;">
  <h3>⚙️ Debug Mode</h3>
  <button onclick="addMinerais(1000)">+1K Minerais</button>
  <button onclick="addMinerais(1000000)">+1M Minerais</button>
  <button onclick="addPrestige()">+1 Prestige</button>
  <button onclick="unlockAllUpgrades()">Débloquer améliorations</button>
</div>

</body>
</html>